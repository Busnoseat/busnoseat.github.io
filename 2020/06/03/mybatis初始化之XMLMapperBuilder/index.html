<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="mybatis," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="在 MyBatis 初始化过程中，会加载 Mapper映射配置文件。而这个步骤的入口是 XMLMapperBuilder。">
<meta property="og:type" content="article">
<meta property="og:title" content="mybatis初始化之XMLMapperBuilder">
<meta property="og:url" content="http://yoursite.com/2020/06/03/mybatis初始化之XMLMapperBuilder/index.html">
<meta property="og:site_name" content="学习是件开心事">
<meta property="og:description" content="在 MyBatis 初始化过程中，会加载 Mapper映射配置文件。而这个步骤的入口是 XMLMapperBuilder。">
<meta property="og:updated_time" content="2020-08-10T15:58:37.940Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="mybatis初始化之XMLMapperBuilder">
<meta name="twitter:description" content="在 MyBatis 初始化过程中，会加载 Mapper映射配置文件。而这个步骤的入口是 XMLMapperBuilder。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/06/03/mybatis初始化之XMLMapperBuilder/"/>





  <title> mybatis初始化之XMLMapperBuilder | 学习是件开心事 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">学习是件开心事</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/03/mybatis初始化之XMLMapperBuilder/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Mr. Xu">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/asset/blogImg/blogUser.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="学习是件开心事">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="学习是件开心事" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                mybatis初始化之XMLMapperBuilder
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-03T22:01:13+08:00">
                2020-06-03
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>在 MyBatis 初始化过程中，会加载 Mapper映射配置文件。而这个步骤的入口是 XMLMapperBuilder。<br><a id="more"></a></p>
<h1 id="parse方法"><a href="#parse方法" class="headerlink" title="parse方法"></a>parse方法</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line"></div><div class="line">public void parse() &#123;</div><div class="line">    // &lt;1&gt; 判断当前 Mapper 是否已经加载过</div><div class="line">    if (!configuration.isResourceLoaded(resource)) &#123;</div><div class="line">        // &lt;2&gt; 解析 &lt;mapper/&gt; 节点</div><div class="line">        configurationElement(parser.evalNode(&quot;/mapper&quot;));</div><div class="line">        // &lt;3&gt; 标记该 Mapper 已经加载过</div><div class="line">        configuration.addLoadedResource(resource);</div><div class="line">        // &lt;4&gt; 绑定 Mapper</div><div class="line">        bindMapperForNamespace();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // &lt;5&gt; 解析待定的 &lt;resultMap /&gt; 节点</div><div class="line">    parsePendingResultMaps();</div><div class="line">    // &lt;6&gt; 解析待定的 &lt;cache-ref /&gt; 节点</div><div class="line">    parsePendingCacheRefs();</div><div class="line">    // &lt;7&gt; 解析待定的 SQL 语句的节点</div><div class="line">    parsePendingStatements();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="判断当前-Mapper-是否已经加载过"><a href="#判断当前-Mapper-是否已经加载过" class="headerlink" title="判断当前 Mapper 是否已经加载过"></a>判断当前 Mapper 是否已经加载过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// Configuration.java</div><div class="line"></div><div class="line">// 已加载资源( Resource )集合</div><div class="line">protected final Set&lt;String&gt; loadedResources = new HashSet&lt;&gt;();</div><div class="line"></div><div class="line">public boolean isResourceLoaded(String resource) &#123;</div><div class="line">    return loadedResources.contains(resource);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>调用 Configuration#isResourceLoaded(String resource) 方法，判断当前 Mapper 是否已经加载过。</p>
<h2 id="configurationElement方法解析节点"><a href="#configurationElement方法解析节点" class="headerlink" title="configurationElement方法解析节点"></a>configurationElement方法解析<mapper>节点</mapper></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line"></div><div class="line">private void configurationElement(XNode context) &#123;</div><div class="line">    try &#123;</div><div class="line">        // &lt;2.1&gt; 获得 namespace 属性</div><div class="line">        String namespace = context.getStringAttribute(&quot;namespace&quot;);</div><div class="line">        if (namespace == null || namespace.equals(&quot;&quot;)) &#123;</div><div class="line">            throw new BuilderException(&quot;Mapper&apos;s namespace cannot be empty&quot;);</div><div class="line">        &#125;</div><div class="line">        // &lt;2.1&gt; 设置 namespace 属性</div><div class="line">        builderAssistant.setCurrentNamespace(namespace);</div><div class="line">        // &lt;2.2&gt; 解析 &lt;cache-ref /&gt; 节点</div><div class="line">        cacheRefElement(context.evalNode(&quot;cache-ref&quot;));</div><div class="line">        // &lt;2.3&gt; 解析 &lt;cache /&gt; 节点</div><div class="line">        cacheElement(context.evalNode(&quot;cache&quot;));</div><div class="line">        // 已废弃！老式风格的参数映射。内联参数是首选,这个元素可能在将来被移除，这里不会记录。</div><div class="line">        parameterMapElement(context.evalNodes(&quot;/mapper/parameterMap&quot;));</div><div class="line">        // &lt;2.4&gt; 解析 &lt;resultMap /&gt; 节点们</div><div class="line">        resultMapElements(context.evalNodes(&quot;/mapper/resultMap&quot;));</div><div class="line">        // &lt;2.5&gt; 解析 &lt;sql /&gt; 节点们</div><div class="line">        sqlElement(context.evalNodes(&quot;/mapper/sql&quot;));</div><div class="line">        // &lt;2.6&gt; 解析 &lt;select /&gt; &lt;insert /&gt; &lt;update /&gt; &lt;delete /&gt; 节点们</div><div class="line">        buildStatementFromContext(context.evalNodes(&quot;select|insert|update|delete&quot;));</div><div class="line">    &#125; catch (Exception e) &#123;</div><div class="line">        throw new BuilderException(&quot;Error parsing Mapper XML. The XML location is &apos;&quot; + resource + &quot;&apos;. Cause: &quot; + e, e);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="cacheRefElement解析cache-ref节点"><a href="#cacheRefElement解析cache-ref节点" class="headerlink" title="cacheRefElement解析cache-ref节点"></a>cacheRefElement解析<code>cache-ref</code>节点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;cache-ref namespace=&quot;com.someone.application.data.SomeMapper&quot;/&gt;</div></pre></td></tr></table></figure>
<p>对某一命名空间的语句，只会使用该命名空间的缓存进行缓存或刷新。 但你可能会想要在多个命名空间中共享相同的缓存配置和实例。要实现这种需求，你可以使用 cache-ref 元素来引用另一个缓存。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line">private void cacheRefElement(XNode context) &#123;</div><div class="line">    if (context != null) &#123;</div><div class="line">        // &lt;2.2.1&gt; 获得指向的 namespace 名字，并添加到 configuration 的 cacheRefMap 中</div><div class="line">        configuration.addCacheRef(builderAssistant.getCurrentNamespace(), context.getStringAttribute(&quot;namespace&quot;));</div><div class="line">        // &lt;2.2.2&gt; 创建 CacheRefResolver 对象，并执行解析</div><div class="line">        CacheRefResolver cacheRefResolver = new CacheRefResolver(builderAssistant, context.getStringAttribute(&quot;namespace&quot;));</div><div class="line">        try &#123;</div><div class="line">            cacheRefResolver.resolveCacheRef();</div><div class="line">        &#125; catch (IncompleteElementException e) &#123;</div><div class="line">            // &lt;2.2.3&gt; 解析失败，添加到 configuration 的 incompleteCacheRefs 中</div><div class="line">            configuration.addIncompleteCacheRef(cacheRefResolver);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>获得指向的 namespace 名字，并调用 Configuration#addCacheRef(String namespace, String referencedNamespace) 方法，添加到 configuration 的 cacheRefMap</li>
<li>创建 CacheRefResolver 对象，并调用 CacheRefResolver#resolveCacheRef() 方法，执行解析。方法中，会调用 <strong>MapperBuilderAssistant#useCacheRef(String namespace)</strong> 方法，获得指向的 Cache 对象。</li>
<li>解析失败，因为此处指向的 Cache 对象可能未初始化，则先调用 Configuration#addIncompleteCacheRef(CacheRefResolver incompleteCacheRef) 方法，添加到 configuration 的 incompleteCacheRefs</li>
</ul>
<h3 id="cacheElement解析cache节点"><a href="#cacheElement解析cache节点" class="headerlink" title="cacheElement解析cache节点"></a>cacheElement解析<code>cache</code>节点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// 使用默认缓存</div><div class="line">&lt;cache eviction=&quot;FIFO&quot; flushInterval=&quot;60000&quot;  size=&quot;512&quot; readOnly=&quot;true&quot;/&gt;</div><div class="line"></div><div class="line">// 使用自定义缓存</div><div class="line">&lt;cache type=&quot;com.domain.something.MyCustomCache&quot;&gt;</div><div class="line">  &lt;property name=&quot;cacheFile&quot; value=&quot;/tmp/my-custom-cache.tmp&quot;/&gt;</div><div class="line">&lt;/cache&gt;</div></pre></td></tr></table></figure>
<p>默认情况下，mybatis只启用了本地的会话缓存，它仅仅对一个会话中的数据进行缓存。 要启用全局的二级缓存，只需要在你的 SQL 映射文件中添加以上的cache标签</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line"></div><div class="line">private void cacheElement(XNode context) throws Exception &#123;</div><div class="line">    if (context != null) &#123;</div><div class="line">        // &lt;1&gt; 获得负责存储的 Cache 实现类</div><div class="line">        String type = context.getStringAttribute(&quot;type&quot;, &quot;PERPETUAL&quot;);</div><div class="line">        Class&lt;? extends Cache&gt; typeClass = typeAliasRegistry.resolveAlias(type);</div><div class="line">        // &lt;2&gt; 获得负责过期的 Cache 实现类</div><div class="line">        String eviction = context.getStringAttribute(&quot;eviction&quot;, &quot;LRU&quot;);</div><div class="line">        Class&lt;? extends Cache&gt; evictionClass = typeAliasRegistry.resolveAlias(eviction);</div><div class="line">        // &lt;3&gt; 获得 flushInterval、size、readWrite、blocking 属性</div><div class="line">        Long flushInterval = context.getLongAttribute(&quot;flushInterval&quot;);</div><div class="line">        Integer size = context.getIntAttribute(&quot;size&quot;);</div><div class="line">        boolean readWrite = !context.getBooleanAttribute(&quot;readOnly&quot;, false);</div><div class="line">        boolean blocking = context.getBooleanAttribute(&quot;blocking&quot;, false);</div><div class="line">        // &lt;4&gt; 获得 Properties 属性</div><div class="line">        Properties props = context.getChildrenAsProperties();</div><div class="line">        // &lt;5&gt; 创建 Cache 对象</div><div class="line">        builderAssistant.useNewCache(typeClass, evictionClass, flushInterval, size, readWrite, blocking, props);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="解析resultMap节点们"><a href="#解析resultMap节点们" class="headerlink" title="解析resultMap节点们"></a>解析resultMap节点们</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line"></div><div class="line">// 解析 &lt;resultMap /&gt; 节点们</div><div class="line">private void resultMapElements(List&lt;XNode&gt; list) throws Exception &#123;</div><div class="line">    // 遍历 &lt;resultMap /&gt; 节点们</div><div class="line">    for (XNode resultMapNode : list) &#123;</div><div class="line">        try &#123;</div><div class="line">            // 处理单个 &lt;resultMap /&gt; 节点</div><div class="line">            resultMapElement(resultMapNode);</div><div class="line">        &#125; catch (IncompleteElementException e) &#123;</div><div class="line">            // ignore, it will be retried</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 解析 &lt;resultMap /&gt; 节点</div><div class="line">private ResultMap resultMapElement(XNode resultMapNode) throws Exception &#123;</div><div class="line">    return resultMapElement(resultMapNode, Collections.&lt;ResultMapping&gt;emptyList());</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 解析 &lt;resultMap /&gt; 节点</div><div class="line">private ResultMap resultMapElement(XNode resultMapNode, List&lt;ResultMapping&gt; additionalResultMappings) throws Exception &#123;</div><div class="line">    ErrorContext.instance().activity(&quot;processing &quot; + resultMapNode.getValueBasedIdentifier());</div><div class="line">    // &lt;1&gt; 获得 id 属性</div><div class="line">    String id = resultMapNode.getStringAttribute(&quot;id&quot;,</div><div class="line">            resultMapNode.getValueBasedIdentifier());</div><div class="line">    // &lt;1&gt; 获得 type 属性</div><div class="line">    String type = resultMapNode.getStringAttribute(&quot;type&quot;,</div><div class="line">            resultMapNode.getStringAttribute(&quot;ofType&quot;,</div><div class="line">                    resultMapNode.getStringAttribute(&quot;resultType&quot;,</div><div class="line">                            resultMapNode.getStringAttribute(&quot;javaType&quot;))));</div><div class="line">    // &lt;1&gt; 获得 extends 属性</div><div class="line">    String extend = resultMapNode.getStringAttribute(&quot;extends&quot;);</div><div class="line">    // &lt;1&gt; 获得 autoMapping 属性</div><div class="line">    Boolean autoMapping = resultMapNode.getBooleanAttribute(&quot;autoMapping&quot;);</div><div class="line">    // &lt;1&gt; 解析 type 对应的类</div><div class="line">    Class&lt;?&gt; typeClass = resolveClass(type);</div><div class="line">    Discriminator discriminator = null;</div><div class="line">    // &lt;2&gt; 创建 ResultMapping 集合</div><div class="line">    List&lt;ResultMapping&gt; resultMappings = new ArrayList&lt;&gt;();</div><div class="line">    resultMappings.addAll(additionalResultMappings);</div><div class="line">    // &lt;2&gt; 遍历 &lt;resultMap /&gt; 的子节点</div><div class="line">    List&lt;XNode&gt; resultChildren = resultMapNode.getChildren();</div><div class="line">    for (XNode resultChild : resultChildren) &#123;</div><div class="line">        // &lt;2.1&gt; 处理 &lt;constructor /&gt; 节点</div><div class="line">        if (&quot;constructor&quot;.equals(resultChild.getName())) &#123;</div><div class="line">            processConstructorElement(resultChild, typeClass, resultMappings);</div><div class="line">        // &lt;2.2&gt; 处理 &lt;discriminator /&gt; 节点</div><div class="line">        &#125; else if (&quot;discriminator&quot;.equals(resultChild.getName())) &#123;</div><div class="line">            discriminator = processDiscriminatorElement(resultChild, typeClass, resultMappings);</div><div class="line">        // &lt;2.3&gt; 处理其它节点</div><div class="line">        &#125; else &#123;</div><div class="line">            List&lt;ResultFlag&gt; flags = new ArrayList&lt;&gt;();</div><div class="line">            if (&quot;id&quot;.equals(resultChild.getName())) &#123;</div><div class="line">                flags.add(ResultFlag.ID);</div><div class="line">            &#125;</div><div class="line">            resultMappings.add(buildResultMappingFromContext(resultChild, typeClass, flags));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    // &lt;3&gt; 创建 ResultMapResolver 对象，执行解析</div><div class="line">    ResultMapResolver resultMapResolver = new ResultMapResolver(builderAssistant, id, typeClass, extend, discriminator, resultMappings, autoMapping);</div><div class="line">    try &#123;</div><div class="line">        return resultMapResolver.resolve();</div><div class="line">    &#125; catch (IncompleteElementException e) &#123;</div><div class="line">        // &lt;4&gt; 解析失败，添加到 configuration 中</div><div class="line">        configuration.addIncompleteResultMap(resultMapResolver);</div><div class="line">        throw e;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="processConstructorElement方法处理-lt-constructor-gt-节点"><a href="#processConstructorElement方法处理-lt-constructor-gt-节点" class="headerlink" title="processConstructorElement方法处理 &lt;constructor /&gt;节点"></a>processConstructorElement方法处理 <code>&lt;constructor /&gt;</code>节点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line"></div><div class="line">private void processConstructorElement(XNode resultChild, Class&lt;?&gt; resultType, List&lt;ResultMapping&gt; resultMappings) throws Exception &#123;</div><div class="line">    // &lt;1&gt; 遍历 &lt;constructor /&gt; 的子节点们</div><div class="line">    List&lt;XNode&gt; argChildren = resultChild.getChildren();</div><div class="line">    for (XNode argChild : argChildren) &#123;</div><div class="line">        // &lt;2&gt; 获得 ResultFlag 集合</div><div class="line">        List&lt;ResultFlag&gt; flags = new ArrayList&lt;&gt;();</div><div class="line">        flags.add(ResultFlag.CONSTRUCTOR);</div><div class="line">        if (&quot;idArg&quot;.equals(argChild.getName())) &#123;</div><div class="line">            flags.add(ResultFlag.ID);</div><div class="line">        &#125;</div><div class="line">        // &lt;3&gt; 将当前子节点构建成 ResultMapping 对象，并添加到 resultMappings 中</div><div class="line">        resultMappings.add(buildResultMappingFromContext(argChild, resultType, flags));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="processDiscriminatorElement方法处理-lt-discriminator-gt-节点"><a href="#processDiscriminatorElement方法处理-lt-discriminator-gt-节点" class="headerlink" title="processDiscriminatorElement方法处理 &lt;discriminator /&gt; 节点"></a>processDiscriminatorElement方法处理 <code>&lt;discriminator /&gt;</code> 节点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line"></div><div class="line">private Discriminator processDiscriminatorElement(XNode context, Class&lt;?&gt; resultType, List&lt;ResultMapping&gt; resultMappings) throws Exception &#123;</div><div class="line">    // &lt;1&gt; 解析各种属性</div><div class="line">    String column = context.getStringAttribute(&quot;column&quot;);</div><div class="line">    String javaType = context.getStringAttribute(&quot;javaType&quot;);</div><div class="line">    String jdbcType = context.getStringAttribute(&quot;jdbcType&quot;);</div><div class="line">    String typeHandler = context.getStringAttribute(&quot;typeHandler&quot;);</div><div class="line">    // &lt;1&gt; 解析各种属性对应的类</div><div class="line">    Class&lt;?&gt; javaTypeClass = resolveClass(javaType);</div><div class="line">    Class&lt;? extends TypeHandler&lt;?&gt;&gt; typeHandlerClass = resolveClass(typeHandler);</div><div class="line">    JdbcType jdbcTypeEnum = resolveJdbcType(jdbcType);</div><div class="line">    // &lt;2&gt; 遍历 &lt;discriminator /&gt; 的子节点，解析成 discriminatorMap 集合</div><div class="line">    Map&lt;String, String&gt; discriminatorMap = new HashMap&lt;&gt;();</div><div class="line">    for (XNode caseChild : context.getChildren()) &#123;</div><div class="line">        String value = caseChild.getStringAttribute(&quot;value&quot;);</div><div class="line">       // &lt;2.1&gt; 处，如果是内嵌的 ResultMap 的情况，则调用 #processNestedResultMappings(XNode context, List&lt;ResultMapping&gt; resultMappings) 方法，处理内嵌的 ResultMap 的情况。</div><div class="line">        String resultMap = caseChild.getStringAttribute(&quot;resultMap&quot;, processNestedResultMappings(caseChild, resultMappings)); // &lt;2.1&gt;</div><div class="line">        discriminatorMap.put(value, resultMap);</div><div class="line">    &#125;</div><div class="line">    // &lt;3&gt;调用 MapperBuilderAssistant#buildDiscriminator(...) 方法，创建 Discriminator 对象。详细解析</div><div class="line">    return builderAssistant.buildDiscriminator(resultType, column, javaTypeClass, jdbcTypeEnum, typeHandlerClass, discriminatorMap);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="processNestedResultMappings解析内嵌的resultMap"><a href="#processNestedResultMappings解析内嵌的resultMap" class="headerlink" title="processNestedResultMappings解析内嵌的resultMap"></a>processNestedResultMappings解析内嵌的resultMap</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line"></div><div class="line">private String processNestedResultMappings(XNode context, List&lt;ResultMapping&gt; resultMappings) throws Exception &#123;</div><div class="line">    if (&quot;association&quot;.equals(context.getName())</div><div class="line">            || &quot;collection&quot;.equals(context.getName())</div><div class="line">            || &quot;case&quot;.equals(context.getName())) &#123;</div><div class="line">        if (context.getStringAttribute(&quot;select&quot;) == null) &#123;</div><div class="line">            // 解析，并返回 ResultMap</div><div class="line">            ResultMap resultMap = resultMapElement(context, resultMappings);</div><div class="line">            return resultMap.getId();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return null;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>该方法，会“递归”调用 #resultMapElement(XNode context, List<resultmapping> resultMappings) 方法，处理内嵌的 ResultMap 的情况</resultmapping></p>
<h4 id="buildResultMappingFromContext方法处理其他节点"><a href="#buildResultMappingFromContext方法处理其他节点" class="headerlink" title="buildResultMappingFromContext方法处理其他节点"></a>buildResultMappingFromContext方法处理其他节点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line"></div><div class="line">private ResultMapping buildResultMappingFromContext(XNode context, Class&lt;?&gt; resultType, List&lt;ResultFlag&gt; flags) throws Exception &#123;</div><div class="line">    // &lt;1&gt; 获得各种属性</div><div class="line">    String property;</div><div class="line">    if (flags.contains(ResultFlag.CONSTRUCTOR)) &#123;</div><div class="line">        property = context.getStringAttribute(&quot;name&quot;);</div><div class="line">    &#125; else &#123;</div><div class="line">        property = context.getStringAttribute(&quot;property&quot;);</div><div class="line">    &#125;</div><div class="line">    String column = context.getStringAttribute(&quot;column&quot;);</div><div class="line">    String javaType = context.getStringAttribute(&quot;javaType&quot;);</div><div class="line">    String jdbcType = context.getStringAttribute(&quot;jdbcType&quot;);</div><div class="line">    String nestedSelect = context.getStringAttribute(&quot;select&quot;);</div><div class="line">    String nestedResultMap = context.getStringAttribute(&quot;resultMap&quot;,</div><div class="line">            processNestedResultMappings(context, Collections.emptyList()));</div><div class="line">    String notNullColumn = context.getStringAttribute(&quot;notNullColumn&quot;);</div><div class="line">    String columnPrefix = context.getStringAttribute(&quot;columnPrefix&quot;);</div><div class="line">    String typeHandler = context.getStringAttribute(&quot;typeHandler&quot;);</div><div class="line">    String resultSet = context.getStringAttribute(&quot;resultSet&quot;);</div><div class="line">    String foreignColumn = context.getStringAttribute(&quot;foreignColumn&quot;);</div><div class="line">    boolean lazy = &quot;lazy&quot;.equals(context.getStringAttribute(&quot;fetchType&quot;, configuration.isLazyLoadingEnabled() ? &quot;lazy&quot; : &quot;eager&quot;));</div><div class="line">    // &lt;1&gt; 获得各种属性对应的类</div><div class="line">    Class&lt;?&gt; javaTypeClass = resolveClass(javaType);</div><div class="line">    Class&lt;? extends TypeHandler&lt;?&gt;&gt; typeHandlerClass = resolveClass(typeHandler);</div><div class="line">    JdbcType jdbcTypeEnum = resolveJdbcType(jdbcType);</div><div class="line">    // &lt;2&gt; 构建 ResultMapping 对象</div><div class="line">    return builderAssistant.buildResultMapping(resultType, property, column, javaTypeClass, jdbcTypeEnum, nestedSelect, nestedResultMap, notNullColumn, columnPrefix, typeHandlerClass, flags, resultSet, foreignColumn, lazy);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="resultMapResolver-resolve-解析"><a href="#resultMapResolver-resolve-解析" class="headerlink" title="resultMapResolver.resolve()解析"></a>resultMapResolver.resolve()解析</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// ResultMapResolver.java</div><div class="line"></div><div class="line">public ResultMap resolve() &#123;</div><div class="line">    return assistant.addResultMap(this.id, this.type, this.extend, this.discriminator, this.resultMappings, this.autoMapping);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在 #resolve() 方法中，会调用 MapperBuilderAssistant#addResultMap(…) 方法，创建 ResultMap 对象。详细解析</p>
<h3 id="sqlElement-List-解析-lt-sql-gt-节点们"><a href="#sqlElement-List-解析-lt-sql-gt-节点们" class="headerlink" title="sqlElement(List) 解析 &lt;sql /&gt; 节点们"></a>sqlElement(List<xnode>) 解析 <code>&lt;sql /&gt;</code> 节点们</xnode></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line"></div><div class="line">private void sqlElement(List&lt;XNode&gt; list) throws Exception &#123;</div><div class="line">    if (configuration.getDatabaseId() != null) &#123;</div><div class="line">        sqlElement(list, configuration.getDatabaseId());</div><div class="line">    &#125;</div><div class="line">    sqlElement(list, null);</div><div class="line">    // 上面两块代码，可以简写成 sqlElement(list, configuration.getDatabaseId());</div><div class="line">&#125;</div><div class="line"></div><div class="line">private void sqlElement(List&lt;XNode&gt; list, String requiredDatabaseId) throws Exception &#123;</div><div class="line">    // &lt;1&gt; 遍历所有 &lt;sql /&gt; 节点</div><div class="line">    for (XNode context : list) &#123;</div><div class="line">        // &lt;2&gt; 获得 databaseId 属性</div><div class="line">        String databaseId = context.getStringAttribute(&quot;databaseId&quot;);</div><div class="line">        // &lt;3&gt; 获得完整的 id 属性，格式为 `$&#123;namespace&#125;.$&#123;id&#125;` 。</div><div class="line">        String id = context.getStringAttribute(&quot;id&quot;);</div><div class="line">        id = builderAssistant.applyCurrentNamespace(id, false);</div><div class="line">        // &lt;4&gt; 判断 databaseId 是否匹配</div><div class="line">        if (databaseIdMatchesCurrent(id, databaseId, requiredDatabaseId)) &#123;</div><div class="line">            // &lt;5&gt; 添加到 sqlFragments 中</div><div class="line">            sqlFragments.put(id, context);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="databaseIdMatchesCurrent方法，判断databaseId是否匹配"><a href="#databaseIdMatchesCurrent方法，判断databaseId是否匹配" class="headerlink" title="databaseIdMatchesCurrent方法，判断databaseId是否匹配"></a>databaseIdMatchesCurrent方法，判断databaseId是否匹配</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line"></div><div class="line">private boolean databaseIdMatchesCurrent(String id, String databaseId, String requiredDatabaseId) &#123;</div><div class="line">    // 如果不匹配，则返回 false</div><div class="line">    if (requiredDatabaseId != null) &#123;</div><div class="line">        return requiredDatabaseId.equals(databaseId);</div><div class="line">    &#125; else &#123;</div><div class="line">        // 如果未设置 requiredDatabaseId ，但是 databaseId 存在，说明还是不匹配，则返回 false</div><div class="line">        // mmp ，写的好绕</div><div class="line">        if (databaseId != null) &#123;</div><div class="line">            return false;</div><div class="line">        &#125;</div><div class="line">        // skip this fragment if there is a previous one with a not null databaseId</div><div class="line">        // 判断是否已经存在</div><div class="line">        if (this.sqlFragments.containsKey(id)) &#123;</div><div class="line">            XNode context = this.sqlFragments.get(id);</div><div class="line">            // 若存在，则判断原有的 sqlFragment 是否 databaseId 为空。因为，当前 databaseId 为空，这样两者才能匹配。</div><div class="line">            return context.getStringAttribute(&quot;databaseId&quot;) == null;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return true;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="buildStatementFromContext-…-方法，解解析-lt-insert-delete-update-select-gt-节点们"><a href="#buildStatementFromContext-…-方法，解解析-lt-insert-delete-update-select-gt-节点们" class="headerlink" title="buildStatementFromContext(…) 方法，解解析 &lt;insert/delete/update/select/&gt; 节点们"></a>buildStatementFromContext(…) 方法，解解析 <code>&lt;insert/delete/update/select/&gt;</code> 节点们</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line"></div><div class="line">private void buildStatementFromContext(List&lt;XNode&gt; list) &#123;</div><div class="line">    if (configuration.getDatabaseId() != null) &#123;</div><div class="line">        buildStatementFromContext(list, configuration.getDatabaseId());</div><div class="line">    &#125;</div><div class="line">    buildStatementFromContext(list, null);</div><div class="line">    // 上面两块代码，可以简写成 buildStatementFromContext(list, configuration.getDatabaseId());</div><div class="line">&#125;</div><div class="line"></div><div class="line">private void buildStatementFromContext(List&lt;XNode&gt; list, String requiredDatabaseId) &#123;</div><div class="line">    // &lt;1&gt; 遍历 &lt;select /&gt; &lt;insert /&gt; &lt;update /&gt; &lt;delete /&gt; 节点们</div><div class="line">    for (XNode context : list) &#123;</div><div class="line">        // &lt;1&gt; 创建 XMLStatementBuilder 对象，执行解析</div><div class="line">        final XMLStatementBuilder statementParser = new XMLStatementBuilder(configuration, builderAssistant, context, requiredDatabaseId);</div><div class="line">        try &#123;</div><div class="line">            statementParser.parseStatementNode();</div><div class="line">        &#125; catch (IncompleteElementException e) &#123;</div><div class="line">            // &lt;2&gt; 解析失败，添加到 configuration 中</div><div class="line">            configuration.addIncompleteStatement(statementParser);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="标记该-Mapper-已经加载过"><a href="#标记该-Mapper-已经加载过" class="headerlink" title="标记该 Mapper 已经加载过"></a>标记该 Mapper 已经加载过</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">调用 Configuration#addLoadedResource(String resource) 方法，标记该 Mapper 已经加载过。</div><div class="line">// Configuration.java</div><div class="line"></div><div class="line">public void addLoadedResource(String resource) &#123;</div><div class="line">    loadedResources.add(resource);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="调用-bindMapperForNamespace-方法，绑定-Mapper"><a href="#调用-bindMapperForNamespace-方法，绑定-Mapper" class="headerlink" title="调用 #bindMapperForNamespace() 方法，绑定 Mapper"></a>调用 #bindMapperForNamespace() 方法，绑定 Mapper</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line"></div><div class="line">private void bindMapperForNamespace() &#123;</div><div class="line">    String namespace = builderAssistant.getCurrentNamespace();</div><div class="line">    if (namespace != null) &#123;</div><div class="line">        // &lt;1&gt; 获得 Mapper 映射配置文件对应的 Mapper 接口，实际上类名就是 namespace 。嘿嘿，这个是常识。</div><div class="line">        Class&lt;?&gt; boundType = null;</div><div class="line">        try &#123;</div><div class="line">            boundType = Resources.classForName(namespace);</div><div class="line">        &#125; catch (ClassNotFoundException e) &#123;</div><div class="line">            //ignore, bound type is not required</div><div class="line">        &#125;</div><div class="line">        if (boundType != null) &#123;</div><div class="line">            // &lt;2&gt; 不存在该 Mapper 接口，则进行添加</div><div class="line">            if (!configuration.hasMapper(boundType)) &#123;</div><div class="line">                // Spring may not know the real resource name so we set a flag</div><div class="line">                // to prevent loading again this resource from the mapper interface</div><div class="line">                // look at MapperAnnotationBuilder#loadXmlResource</div><div class="line">                // &lt;3&gt; 标记 namespace 已经添加，避免 MapperAnnotationBuilder#loadXmlResource(...) 重复加载</div><div class="line">                configuration.addLoadedResource(&quot;namespace:&quot; + namespace);</div><div class="line">                // &lt;4&gt; 添加到 configuration 中</div><div class="line">                configuration.addMapper(boundType);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="parsePendingResultMaps解析待定的-lt-resultMap-gt-节点"><a href="#parsePendingResultMaps解析待定的-lt-resultMap-gt-节点" class="headerlink" title="parsePendingResultMaps解析待定的 &lt;resultMap /&gt; 节点"></a>parsePendingResultMaps解析待定的 <code>&lt;resultMap /&gt;</code> 节点</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line"></div><div class="line">private void parsePendingResultMaps() &#123;</div><div class="line">    // 获得 ResultMapResolver 集合，并遍历进行处理</div><div class="line">    Collection&lt;ResultMapResolver&gt; incompleteResultMaps = configuration.getIncompleteResultMaps();</div><div class="line">    synchronized (incompleteResultMaps) &#123;</div><div class="line">        Iterator&lt;ResultMapResolver&gt; iter = incompleteResultMaps.iterator();</div><div class="line">        while (iter.hasNext()) &#123;</div><div class="line">            try &#123;</div><div class="line">                // 执行解析</div><div class="line">                iter.next().resolve();</div><div class="line">                // 移除</div><div class="line">                iter.remove();</div><div class="line">            &#125; catch (IncompleteElementException e) &#123;</div><div class="line">                // ResultMap is still missing a resource...</div><div class="line">                // 解析失败，不抛出异常</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="parsePendingCacheRefs解析待定的-lt-cache-ref-gt-节点"><a href="#parsePendingCacheRefs解析待定的-lt-cache-ref-gt-节点" class="headerlink" title="parsePendingCacheRefs解析待定的 &lt;cache-ref /&gt;  节点"></a>parsePendingCacheRefs解析待定的 <code>&lt;cache-ref /&gt;</code>  节点</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line"></div><div class="line">private void parsePendingCacheRefs() &#123;</div><div class="line">    // 获得 CacheRefResolver 集合，并遍历进行处理</div><div class="line">    Collection&lt;CacheRefResolver&gt; incompleteCacheRefs = configuration.getIncompleteCacheRefs();</div><div class="line">    synchronized (incompleteCacheRefs) &#123;</div><div class="line">        Iterator&lt;CacheRefResolver&gt; iter = incompleteCacheRefs.iterator();</div><div class="line">        while (iter.hasNext()) &#123;</div><div class="line">            try &#123;</div><div class="line">                // 执行解析</div><div class="line">                iter.next().resolveCacheRef();</div><div class="line">                // 移除</div><div class="line">                iter.remove();</div><div class="line">            &#125; catch (IncompleteElementException e) &#123;</div><div class="line">                // Cache ref is still missing a resource...</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="解析待定的-SQL-语句的节点"><a href="#解析待定的-SQL-语句的节点" class="headerlink" title="解析待定的 SQL 语句的节点"></a>解析待定的 SQL 语句的节点</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">// XMLMapperBuilder.java</div><div class="line"></div><div class="line">private void parsePendingStatements() &#123;</div><div class="line">    // 获得 XMLStatementBuilder 集合，并遍历进行处理</div><div class="line">    Collection&lt;XMLStatementBuilder&gt; incompleteStatements = configuration.getIncompleteStatements();</div><div class="line">    synchronized (incompleteStatements) &#123;</div><div class="line">        Iterator&lt;XMLStatementBuilder&gt; iter = incompleteStatements.iterator();</div><div class="line">        while (iter.hasNext()) &#123;</div><div class="line">            try &#123;</div><div class="line">                // 执行解析</div><div class="line">                iter.next().parseStatementNode();</div><div class="line">                // 移除</div><div class="line">                iter.remove();</div><div class="line">            &#125; catch (IncompleteElementException e) &#123;</div><div class="line">                // Statement is still missing a resource...</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>【相关文献】</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/mybatis/" rel="tag"># mybatis</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/06/02/mybatis初始化之XMLConfigBuilder/" rel="next" title="mybatis初始化之XMLConfigBuilder">
                <i class="fa fa-chevron-left"></i> mybatis初始化之XMLConfigBuilder
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/06/08/Localdate的用法示例/" rel="prev" title="Localdate的用法示例">
                Localdate的用法示例 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/asset/blogImg/blogUser.jpg"
               alt="Mr. Xu" />
          <p class="site-author-name" itemprop="name">Mr. Xu</p>
          <p class="site-description motion-element" itemprop="description">记录自己平时的小槽点，<br>不扯天马行空的大道理。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">48</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>


          <!-- 网易云音乐插件 -->
          <div class="links-of-author motion-element">
            <iframe frameborder="no" border="0" marginwidth="0" marginheight="20" width=530 height=86 src="//music.163.com/outchain/player?type=2&id=694286&auto=1&height=66"></iframe>
         </div> 

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#parse方法"><span class="nav-number">1.</span> <span class="nav-text">parse方法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#判断当前-Mapper-是否已经加载过"><span class="nav-number">1.1.</span> <span class="nav-text">判断当前 Mapper 是否已经加载过</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#configurationElement方法解析节点"><span class="nav-number">1.2.</span> <span class="nav-text">configurationElement方法解析节点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cacheRefElement解析cache-ref节点"><span class="nav-number">1.2.1.</span> <span class="nav-text">cacheRefElement解析cache-ref节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cacheElement解析cache节点"><span class="nav-number">1.2.2.</span> <span class="nav-text">cacheElement解析cache节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解析resultMap节点们"><span class="nav-number">1.2.3.</span> <span class="nav-text">解析resultMap节点们</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#processConstructorElement方法处理-lt-constructor-gt-节点"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">processConstructorElement方法处理 <constructor />节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#processDiscriminatorElement方法处理-lt-discriminator-gt-节点"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">processDiscriminatorElement方法处理 <discriminator /> 节点</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#processNestedResultMappings解析内嵌的resultMap"><span class="nav-number">1.2.3.2.1.</span> <span class="nav-text">processNestedResultMappings解析内嵌的resultMap</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#buildResultMappingFromContext方法处理其他节点"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">buildResultMappingFromContext方法处理其他节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#resultMapResolver-resolve-解析"><span class="nav-number">1.2.3.4.</span> <span class="nav-text">resultMapResolver.resolve()解析</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sqlElement-List-解析-lt-sql-gt-节点们"><span class="nav-number">1.2.4.</span> <span class="nav-text">sqlElement(List) 解析 <sql /> 节点们</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#databaseIdMatchesCurrent方法，判断databaseId是否匹配"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">databaseIdMatchesCurrent方法，判断databaseId是否匹配</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#buildStatementFromContext-…-方法，解解析-lt-insert-delete-update-select-gt-节点们"><span class="nav-number">1.2.5.</span> <span class="nav-text">buildStatementFromContext(…) 方法，解解析 <insert/delete/update/select/> 节点们</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#标记该-Mapper-已经加载过"><span class="nav-number">1.3.</span> <span class="nav-text">标记该 Mapper 已经加载过</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#调用-bindMapperForNamespace-方法，绑定-Mapper"><span class="nav-number">1.4.</span> <span class="nav-text">调用 #bindMapperForNamespace() 方法，绑定 Mapper</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#parsePendingResultMaps解析待定的-lt-resultMap-gt-节点"><span class="nav-number">1.5.</span> <span class="nav-text">parsePendingResultMaps解析待定的 <resultMap /> 节点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#parsePendingCacheRefs解析待定的-lt-cache-ref-gt-节点"><span class="nav-number">1.6.</span> <span class="nav-text">parsePendingCacheRefs解析待定的 <cache-ref />  节点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#解析待定的-SQL-语句的节点"><span class="nav-number">1.7.</span> <span class="nav-text">解析待定的 SQL 语句的节点</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr. Xu</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  

  

  

  


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/shizuku.model.json"},"display":{"position":"left","width":200,"height":400,"opacity":0.4},"mobile":{"show":false},"log":false});</script></body>
</html>
